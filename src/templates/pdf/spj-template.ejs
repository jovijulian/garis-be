<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>Surat Perintah Jalan - Request #<%= request.id %></title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: "Times New Roman", Times, serif;
            font-size: 10pt; 
            line-height: 1.2;
            background: white;
            color: #000;
        }

        @page {
            size: 21.6cm 14cm; 
            margin: 5mm;
        }

        .container { width: 100%; }

        .letterhead {
            border-bottom: 2px solid #000;
            padding-bottom: 5px;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .company-name {
            font-size: 12pt;
            font-weight: bold;
            text-transform: uppercase;
            margin-bottom: 2px;
        }
        .company-address { font-size: 8pt; color: #333; }
        .logo-placeholder img { height: 45px; width: auto; }

        .document-header { text-align: center; margin-bottom: 8px; }
        .document-title {
            font-size: 11pt;
            font-weight: bold;
            text-decoration: underline;
            text-transform: uppercase;
        }
        .document-number { font-size: 10pt; font-weight: bold; }

        .section-title {
            font-size: 9pt;
            font-weight: bold;
            border-bottom: 1px solid #000;
            margin-bottom: 4px;
            text-transform: uppercase;
            background-color: #eee;
            padding: 5px 3px;
        }

        .row-split {
            display: flex;
            gap: 20px; 
            margin-bottom: 5px;
        }
        .col-half {
            flex: 1;
        }

        .info-table { width: 100%; border-collapse: collapse; }
        .info-table td {
            vertical-align: top;
            padding: 1px 0;
            font-size: 9pt;
        }
        .info-table td:first-child { width: 90px; font-weight: bold; } 
        .info-table td:nth-child(2) { width: 10px; text-align: center; }

        .grid-table {
            width: 100%;
            border-collapse: collapse;
            border: 1px solid #000;
            margin-bottom: 5px;
        }
        .grid-table th, .grid-table td {
            border: 1px solid #000;
            padding: 3px 5px;
            font-size: 9pt;
        }
        .grid-table th { background-color: #f0f0f0; text-align: center; }

        .notes-box {
            font-size: 9pt;
            font-style: italic;
            margin-top: 2px;
            border: 1px dashed #ccc;
            padding: 3px;
        }

        .footer-signature {
            margin-top: 5px;
            display: flex;
            justify-content: flex-end;
        }
        .sign-box {
            width: 180px;
            text-align: center;
        }
        .sign-date { font-size: 9pt; margin-bottom: 30px; } 
        .sign-name { font-weight: bold; font-size: 9pt; border-top: 1px solid #000; padding-top: 2px; }

        @media print {
            body { -webkit-print-color-adjust: exact; }
            .no-print { display: none; }
        }
    </style>
</head>
<body>

    <div class="container">
        
       

        <div class="document-header">
            <div class="document-title">SURAT PERINTAH JALAN</div>
            <div class="document-number">NO: SPJ/<%= request.id %>/<%= moment().format('MM/YYYY') %></div>
        </div>

        <div class="section-title">I. DATA PERMINTAAN</div>
        
        <div class="row-split">
            <div class="col-half">
                <table class="info-table">
                    <tr>
                        <td>Pemohon</td>
                        <td>:</td>
                        <td><%= request.user?.nama_user || '-' %></td>
                    </tr>
                    <tr>
                        <td>Keperluan</td>
                        <td>:</td>
                        <td><%= request.purpose %></td>
                    </tr>
                    <tr>
                        <td>Tujuan</td>
                        <td>:</td>
                        <td><%= request.destination %></td>
                    </tr>
                    <tr>
                        <td>Jemput di</td>
                        <td>:</td>
                        <td><%= request.pickup_location_text || request.cabang?.nama_cab || '-' %></td>
                    </tr>
                </table>
            </div>

            <div class="col-half">
                <table class="info-table">
                    <tr>
                        <td>Berangkat</td>
                        <td>:</td>
                        <td><%= moment(request.start_time).format('ddd, DD MMM YYYY HH:mm') %></td>
                    </tr>
                    <tr>
                        <td>Kembali</td>
                        <td>:</td>
                        <td><%= request.end_time ? moment(request.end_time).format('ddd, DD MMM YYYY HH:mm') : '-' %></td>
                    </tr>
                    <tr>
                        <td>Penumpang</td>
                        <td>:</td>
                        <td><%= request.passenger_count %> Org (<%= request.passenger_names || '-' %>)</td>
                    </tr>
                </table>
            </div>
        </div>

        <% if (request.note) { %>
            <div class="notes-box"><strong>Catatan:</strong> <%= request.note %></div>
        <% } %>

        <div class="section-title" style="margin-top: 8px;">II. PENUGASAN KENDARAAN</div>
        
        <% if (request.detail && request.detail.length > 0) { %>
            <table class="grid-table">
                <thead>
                    <tr>
                        <th width="5%">No</th>
                        <th width="20%">Kendaraan</th>
                        <th width="15%">No. Polisi</th>
                        <th width="20%">Pengemudi</th>
                        <th width="40%">Keterangan</th>
                    </tr>
                </thead>
                <tbody>
                    <% request.detail.forEach(function(assignment, index){ %>
                    <tr>
                        <td align="center"><%= index + 1 %></td>
                        <td><%= assignment.vehicle?.name || '-' %></td>
                        <td align="center" style="font-weight:bold;"><%= assignment.vehicle?.license_plate || '-' %></td>
                        <td><%= assignment.driver?.name || '-' %></td>
                        <td><%= assignment.note_for_driver || '-' %></td>
                    </tr>
                    <% }); %>
                </tbody>
            </table>
        <% } else { %>
            <div class="notes-box" style="text-align: center; padding: 10px;">
                Belum ada kendaraan yang ditugaskan.
            </div>
        <% } %>

        <div class="footer-signature">
            <div class="sign-box">
                <div class="sign-date">
                    <%= request.cabang?.nama_cab || 'Bandung' %>, <%= moment().format('DD MMM YYYY') %>
                </div>
                <div class="sign-name">( Admin GA / Pool )</div>
            </div>
        </div>

        <div style="font-size: 7pt; color: #888; margin-top: 5px;">
            Generated by GARIS System 
        </div>

    </div>
</body>
</html>